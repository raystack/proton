syntax = "proto3";
package odpf.shield.v1beta1;

import "google/api/annotations.proto";
import "protoc-gen-openapiv2/options/annotations.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";
import "validate/validate.proto";

option go_package = "github.com/odpf/proton/shield/v1;shieldv1beta1";
option java_package = "io.odpf.proton.shield.v1beta1";
option java_outer_classname = "Shield";


// These annotations are used when generating the OpenAPI file.
option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_swagger) = {
  info: {
    title: "Shield",
    version: "0.1.0";
  };
  schemes: HTTP;
};

service ShieldService {
  // Users
  rpc ListUsers(ListUsersRequest) returns (ListUsersResponse) {
    option (google.api.http) = {
      get: "/v1beta1/users"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "User";
      summary: "Get All Users";
    };
  }
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse) {
    option (google.api.http) = {
      post: "/v1beta1/users",
      body: "body";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "User";
      summary: "Create User";
    };
  }

  rpc GetUser(GetUserRequest) returns (GetUserResponse) {
    option (google.api.http) = {
      get: "/v1beta1/users/{id}",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "User";
      summary: "Get a User by id";
    };
  }

  rpc ListUserGroups(ListUserGroupsRequest) returns (ListUserGroupsResponse) {
    option (google.api.http) = {
      get: "/v1beta1/users/{id}/groups",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "User";
      summary: "List Groups of a User";
    };
  }

  rpc GetCurrentUser(GetCurrentUserRequest) returns (GetCurrentUserResponse) {
    option (google.api.http) = {
      get: "/v1beta1/users/self",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "User";
      summary: "Get current user";
    };
  }

  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse) {
    option (google.api.http) = {
      put: "/v1beta1/users/{id}",
      body: "body";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "User";
      summary: "Update User by ID";
    };
  }

  rpc UpdateCurrentUser(UpdateCurrentUserRequest) returns (UpdateCurrentUserResponse) {
    option (google.api.http) = {
      put: "/v1beta1/users/self",
      body: "body";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "User";
      summary: "Update current User";
    };
  }

  // Group
  rpc ListGroups(ListGroupsRequest) returns (ListGroupsResponse) {
    option (google.api.http) = {
      get: "/v1beta1/groups",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Group";
      summary: "Get all Groups";
    };
  }

  rpc CreateGroup(CreateGroupRequest) returns (CreateGroupResponse) {
    option (google.api.http) = {
      post: "/v1beta1/groups",
      body: "body";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Group";
      summary: "Create Group";
    };
  }

  rpc GetGroup(GetGroupRequest) returns (GetGroupResponse) {
    option (google.api.http) = {
      get: "/v1beta1/groups/{id}",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Group";
      summary: "Get Group by ID";
    };
  }

  rpc UpdateGroup(UpdateGroupRequest) returns (UpdateGroupResponse) {
    option (google.api.http) = {
      put: "/v1beta1/groups/{id}",
      body: "body";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Group";
      summary: "Update Group by ID";
    };
  }

  rpc ListGroupUsers(ListGroupUsersRequest) returns (ListGroupUsersResponse) {
    option (google.api.http) = {
      get: "/v1beta1/groups/{id}/users",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Group";
      summary: "Get all Users in a Group";
    };
  }

  rpc AddGroupUser(AddGroupUserRequest) returns (AddGroupUserResponse) {
    option (google.api.http) = {
      post: "/v1beta1/groups/{id}/users",
      body: "body";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Group";
      summary: "Add User to Group";
    };
  }

  rpc RemoveGroupUser(RemoveGroupUserRequest) returns (RemoveGroupUserResponse) {
    option (google.api.http) = {
      delete: "/v1beta1/groups/{id}/users/{user_id}",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Group";
      summary: "Remove User from Group";
    };
  }

  rpc ListGroupAdmins(ListGroupAdminsRequest) returns (ListGroupAdminsResponse) {
    option (google.api.http) = {
      get: "/v1beta1/groups/{id}/admins",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Group";
      summary: "Get all Admins of a Group";
    };
  }

  rpc AddGroupAdmin(AddGroupAdminRequest) returns (AddGroupAdminResponse) {
    option (google.api.http) = {
      post: "/v1beta1/groups/{id}/admins",
      body: "body";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Group";
      summary: "Add Admin to Group";
    };
  }

  rpc RemoveGroupAdmin(RemoveGroupAdminRequest) returns (RemoveGroupAdminResponse) {
    option (google.api.http) = {
      delete: "/v1beta1/groups/{id}/admins/{user_id}",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Group";
      summary: "Remove Admin from Group";
    };
  }

  // Roles
  rpc ListRoles(ListRolesRequest) returns (ListRolesResponse) {
    option (google.api.http) = {
      get: "/v1beta1/roles",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Role";
      summary: "Get all Roles";
    };
  }

  rpc CreateRole(CreateRoleRequest) returns (CreateRoleResponse) {
    option (google.api.http) = {
      post: "/v1beta1/roles",
      body: "body";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Role";
      summary: "Create Role";
    };
  }

  rpc GetRole(GetRoleRequest) returns (GetRoleResponse) {
    option (google.api.http) = {
      get: "/v1beta1/roles/{id}",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Role";
      summary: "Get Role by ID";
    };
  }

  rpc UpdateRole(UpdateRoleRequest) returns (UpdateRoleResponse) {
    option (google.api.http) = {
      put: "/v1beta1/roles/{id}",
      body: "body";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Role";
      summary: "Update Role by ID";
    };
  }

  // Organizations
  rpc ListOrganizations(ListOrganizationsRequest) returns (ListOrganizationsResponse) {
    option (google.api.http) = {
      get: "/v1beta1/organizations"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Organization";
      summary: "Get all Organization";
    };
  }

  rpc CreateOrganization(CreateOrganizationRequest) returns (CreateOrganizationResponse) {
    option (google.api.http) = {
      post: "/v1beta1/organizations",
      body: "body"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Organization";
      summary: "Create Organization";
    };
  }

  rpc GetOrganization(GetOrganizationRequest) returns (GetOrganizationResponse) {
    option (google.api.http) = {
      get: "/v1beta1/organizations/{id}",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Organization";
      summary: "Get Organization by ID";
    };
  }

  rpc UpdateOrganization(UpdateOrganizationRequest) returns (UpdateOrganizationResponse) {
    option (google.api.http) = {
      put: "/v1beta1/organizations/{id}",
      body: "body"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Organization";
      summary: "Update Organization by ID";
    };
  }

  rpc ListOrganizationAdmins(ListOrganizationAdminsRequest) returns (ListOrganizationAdminsResponse) {
    option (google.api.http) = {
      get: "/v1beta1/organizations/{id}/admins",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Organization";
      summary: "Get all Admins of an Organization";
    };
  }

  rpc AddOrganizationAdmin(AddOrganizationAdminRequest) returns (AddOrganizationAdminResponse) {
    option (google.api.http) = {
      post: "/v1beta1/organizations/{id}/admins",
      body: "body";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Organization";
      summary: "Add Admin to Organization";
    };
  }

  rpc RemoveOrganizationAdmin(RemoveOrganizationAdminRequest) returns (RemoveOrganizationAdminResponse) {
    option (google.api.http) = {
      delete: "/v1beta1/organizations/{id}/admins/{user_id}",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Organization";
      summary: "Remove Admin from Organization";
    };
  }

  // Projects
  rpc ListProjects(ListProjectsRequest) returns (ListProjectsResponse) {
    option (google.api.http) = {
      get: "/v1beta1/projects"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Project";
      summary: "Get all Project";
    };
  }

  rpc CreateProject(CreateProjectRequest) returns (CreateProjectResponse) {
    option (google.api.http) = {
      post: "/v1beta1/projects",
      body: "body"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Project";
      summary: "Create Project";
    };
  }

  rpc GetProject(GetProjectRequest) returns (GetProjectResponse) {
    option (google.api.http) = {
      get: "/v1beta1/projects/{id}",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Project";
      summary: "Get Project by ID";
    };
  }

  rpc UpdateProject(UpdateProjectRequest) returns (UpdateProjectResponse) {
    option (google.api.http) = {
      put: "/v1beta1/projects/{id}",
      body: "body"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Project";
      summary: "Update Project by ID";
    };
  }

  rpc ListProjectAdmins(ListProjectAdminsRequest) returns (ListProjectAdminsResponse) {
    option (google.api.http) = {
      get: "/v1beta1/projects/{id}/admins",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Project";
      summary: "Get all Admins of a Project";
    };
  }

  rpc AddProjectAdmin(AddProjectAdminRequest) returns (AddProjectAdminResponse) {
    option (google.api.http) = {
      post: "/v1beta1/projects/{id}/admins",
      body: "body";
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Project";
      summary: "Add Admin to Project";
    };
  }

  rpc RemoveProjectAdmin(RemoveProjectAdminRequest) returns (RemoveProjectAdminResponse) {
    option (google.api.http) = {
      delete: "/v1beta1/projects/{id}/admins/{user_id}",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Project";
      summary: "Remove Admin from Project";
    };
  }

  // Actions
  rpc ListActions(ListActionsRequest) returns (ListActionsResponse) {
    option (google.api.http) = {
      get: "/v1beta1/actions"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Action";
      summary: "Get all Actions";
    };
  }

  rpc CreateAction(CreateActionRequest) returns (CreateActionResponse) {
    option (google.api.http) = {
      post: "/v1beta1/actions",
      body: "body"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Action";
      summary: "Create Action";
    };
  }

  rpc GetAction(GetActionRequest) returns (GetActionResponse) {
    option (google.api.http) = {
      get: "/v1beta1/actions/{id}",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Action";
      summary: "Get Action by ID";
    };
  }

  rpc UpdateAction(UpdateActionRequest) returns (UpdateActionResponse) {
    option (google.api.http) = {
      put: "/v1beta1/actions/{id}",
      body: "body"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Action";
      summary: "Update Action by ID";
    };
  }

  // Namespaces
  rpc ListNamespaces(ListNamespacesRequest) returns (ListNamespacesResponse) {
    option (google.api.http) = {
      get: "/v1beta1/namespaces"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Namespace";
      summary: "Get all Namespaces";
    };
  }

  rpc CreateNamespace(CreateNamespaceRequest) returns (CreateNamespaceResponse) {
    option (google.api.http) = {
      post: "/v1beta1/namespaces",
      body: "body"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Namespace";
      summary: "Create Namespace";
    };
  }

  rpc GetNamespace(GetNamespaceRequest) returns (GetNamespaceResponse) {
    option (google.api.http) = {
      get: "/v1beta1/namespaces/{id}",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Namespace";
      summary: "Get Namespace by ID";
    };
  }

  rpc UpdateNamespace(UpdateNamespaceRequest) returns (UpdateNamespaceResponse) {
    option (google.api.http) = {
      put: "/v1beta1/namespaces/{id}",
      body: "body"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Namespace";
      summary: "Update Namespace by ID";
    };
  }

  // Policies
  rpc ListPolicies(ListPoliciesRequest) returns (ListPoliciesResponse) {
    option (google.api.http) = {
      get: "/v1beta1/policies"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Policy";
      summary: "Get all Policy";
    };
  }

  rpc CreatePolicy(CreatePolicyRequest) returns (CreatePolicyResponse) {
    option (google.api.http) = {
      post: "/v1beta1/policies",
      body: "body"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Policy";
      summary: "Create Policy";
    };
  }

  rpc GetPolicy(GetPolicyRequest) returns (GetPolicyResponse) {
    option (google.api.http) = {
      get: "/v1beta1/policies/{id}",
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Policy";
      summary: "Get Policy by ID";
    };
  }

  rpc UpdatePolicy(UpdatePolicyRequest) returns (UpdatePolicyResponse) {
    option (google.api.http) = {
      put: "/v1beta1/policies/{id}",
      body: "body"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Policy";
      summary: "Update Policy by ID";
    };
  }

    // Relations
    rpc ListRelations(ListRelationsRequest) returns (ListRelationsResponse) {
      option (google.api.http) = {
        get: "/v1beta1/relations"
      };
      option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
        tags: "Relation";
        summary: "Get all Relations";
      };
    }
  
    rpc CreateRelation(CreateRelationRequest) returns (CreateRelationResponse) {
      option (google.api.http) = {
        post: "/v1beta1/relations",
        body: "body"
      };
      option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
        tags: "Relation";
        summary: "Create Relation";
      };
    }
  
    rpc GetRelation(GetRelationRequest) returns (GetRelationResponse) {
      option (google.api.http) = {
        get: "/v1beta1/relations/{id}",
      };
      option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
        tags: "Relation";
        summary: "Get Relation by ID";
      };
    }
  
    rpc UpdateRelation(UpdateRelationRequest) returns (UpdateRelationResponse) {
      option (google.api.http) = {
        put: "/v1beta1/relations/{id}",
        body: "body"
      };
      option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
        tags: "Relation";
        summary: "Update Relation by ID";
      };
    }

    // Resources  
    rpc ListResources(ListResourcesRequest) returns (ListResourcesResponse) {
      option (google.api.http) = {
        get: "/v1beta1/resources"
      };
      option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
        tags: "Resource";
        summary: "Get all Resources";
      };
    }
  
    rpc CreateResource(CreateResourceRequest) returns (CreateResourceResponse) {
      option (google.api.http) = {
        post: "/v1beta1/resources",
        body: "body"
      };
      option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
        tags: "Resource";
        summary: "Create Resource";
      };
    }
  
    rpc GetResource(GetResourceRequest) returns (GetResourceResponse) {
      option (google.api.http) = {
        get: "/v1beta1/resources/{id}",
      };
      option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
        tags: "Resource";
        summary: "Get Resource by ID";
      };
    }
  
    rpc UpdateResource(UpdateResourceRequest) returns (UpdateResourceResponse) {
      option (google.api.http) = {
        put: "/v1beta1/resources/{id}",
        body: "body"
      };
      option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
        tags: "Resource";
        summary: "Update Resource by ID";
      };
    }


    // Authz
    rpc CheckResourcePermission(ResourceActionAuthzRequest) returns (ResourceActionAuthzResponse) {
      option (google.api.http) = {
        post: "/v1beta1/check/{resource_id}",
        body: "*"
      };
      option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
        tags: "Authz";
        summary: "check permission for action on a resource by an user";
      };
    }
}

message UserRequestBody {
  string name = 1 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
  string email = 2 [(validate.rules).string.email = true];
  google.protobuf.Struct metadata = 3;
}

message CreateUserRequest {
  UserRequestBody body = 1;
}

message User {
  string id = 1;
  string name = 2 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"]; 
  string slug = 3;
  string email = 4 [(validate.rules).string.email = true]; 
  google.protobuf.Struct metadata = 5;
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;
}

message CreateUserResponse {
  User user = 1;
}

message GetUserResponse {
  User user = 1;
}

message GetCurrentUserResponse {
  User user = 1;
}

message UpdateUserResponse {
  User user = 1;
}

message UpdateCurrentUserResponse {
  User user = 1;
}

message UpdateUserRequest {
  string id = 1;
  UserRequestBody body = 2;
}

message GetUserRequest {
  string id = 1;
}

message ListUserGroupsRequest {
  string id = 1;
  string role = 2;
}

message GetCurrentUserRequest {
}

message ListUsersRequest {
  int32 page_size = 1;
  int32 page_num = 2;
  string keyword = 3;
}

message ListUsersResponse {
  int32 count = 1;
  repeated User users = 2;
}

message GroupRequestBody {
  string name = 1 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
  string slug = 2;
  google.protobuf.Struct metadata = 3;
  string org_id = 4;
}

message CreateGroupRequest {
  GroupRequestBody body = 1;
}

message ListUserGroupsResponse {
  repeated Group groups = 1;
}

message Group {
  string id = 1;
  string name = 2 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
  string slug = 3;
  string org_id = 4;
  google.protobuf.Struct metadata = 5;
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;
}

message CreateGroupResponse {
  Group group = 1;
}

message GetGroupResponse {
  Group group = 1;
}

message UpdateGroupResponse {
  Group group = 1;
}


message UpdateGroupRequest {
  string id = 1;
  GroupRequestBody body = 2;
}

message UpdateCurrentUserRequest {
  UserRequestBody body = 1;
}

message GetGroupRequest {
  string id = 1;
}

message ListGroupsRequest {
  string user_id = 1 [deprecated = true];
  string org_id = 2 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
}

message ListGroupsResponse {
  repeated Group groups = 1;
}

message ListGroupUsersRequest {
  string id = 1;
}

message ListGroupUsersResponse {
  repeated User users = 1;
}

message AddGroupUserRequestBody {
  repeated string user_ids = 1;
}

message AddGroupUserRequest {
  string id = 1;
  AddGroupUserRequestBody body = 2;
}

message AddGroupUserResponse {
  repeated User users = 1;
}

message RemoveGroupUserRequest {
  string id = 1;
  string user_id = 2;
}

message RemoveGroupUserResponse {
  string message = 1;
}

message ListGroupAdminsRequest {
  string id = 1;
}

message ListGroupAdminsResponse {
  repeated User users = 1;
}

message AddGroupAdminRequestBody {
  repeated string user_ids = 1;
}

message AddGroupAdminRequest {
  string id = 1;
  AddGroupAdminRequestBody body = 2;
}

message AddGroupAdminResponse {
  repeated User users = 1;
}

message RemoveGroupAdminRequest {
  string id = 1;
  string user_id = 2;
}

message RemoveGroupAdminResponse {
  string message = 1;
}

message Role {
  string id = 1;
  string name = 2 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
  repeated string types = 3;
  Namespace namespace = 4;
  google.protobuf.Struct metadata = 5;
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;
}

message RoleRequestBody {
  string id = 1;
  string name = 2 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
  repeated string types = 3;
  string namespace_id = 4;
  google.protobuf.Struct metadata = 5;
}

message CreateRoleRequest {
  RoleRequestBody body = 1;
}

message CreateRoleResponse {
  Role role = 1;
}

message GetRoleResponse {
  Role role = 1;
}

message UpdateRoleResponse {
  Role role = 1;
}

message GetRoleRequest {
  string id = 1;
}

message UpdateRoleRequest {
  string id = 1;
  RoleRequestBody body = 2;
}

message ListRolesRequest {
}

message ListRolesResponse {
  repeated Role roles = 1;
}

message OrganizationRequestBody {
  string name = 1 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
  string slug = 2;
  google.protobuf.Struct metadata = 3;
}

message CreateOrganizationRequest {
  OrganizationRequestBody body = 1;
}

message Organization {
  string id = 1;
  string name = 2 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
  string slug = 3;
  google.protobuf.Struct metadata = 4;
  google.protobuf.Timestamp created_at = 5;
  google.protobuf.Timestamp updated_at = 6;
}

message CreateOrganizationResponse {
  Organization organization = 1;
}

message GetOrganizationResponse {
  Organization organization = 1;
}

message UpdateOrganizationResponse {
  Organization organization = 1;
}

message ListOrganizationsRequest {
}

message ListOrganizationsResponse {
  repeated Organization organizations = 1;
}

message GetOrganizationRequest {
  string id = 1;
}

message UpdateOrganizationRequest {
  string id = 1;
  OrganizationRequestBody body = 2;
}

message ListOrganizationAdminsRequest {
  string id = 1;
}

message ListOrganizationAdminsResponse {
  repeated User users = 1;
}

message AddOrganizationAdminRequestBody {
  repeated string user_ids = 1;
}

message AddOrganizationAdminRequest {
  string id = 1;
  AddOrganizationAdminRequestBody body = 2;
}

message AddOrganizationAdminResponse {
  repeated User users = 1;
}

message RemoveOrganizationAdminRequest {
  string id = 1;
  string user_id = 2;
}

message RemoveOrganizationAdminResponse {
  string message = 1;
}

message ProjectRequestBody {
  string name = 1 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
  string slug = 2;
  google.protobuf.Struct metadata = 3;
  string org_id = 4;
}

message CreateProjectRequest {
  ProjectRequestBody body = 1;
}

message Project {
  string id = 1;
  string name = 2 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
  string slug = 3;
  string org_id = 4;
  google.protobuf.Struct metadata = 5;
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;
}

message CreateProjectResponse {
  Project project = 1;
}

message GetProjectResponse {
  Project project = 1;
}

message UpdateProjectResponse {
  Project project = 1;
}

message ListProjectsRequest {
}

message ListProjectsResponse {
  repeated Project projects = 1;
}

message GetProjectRequest {
  string id = 1;
}

message UpdateProjectRequest {
  string id = 1;
  ProjectRequestBody body = 2;
}

message ListProjectAdminsRequest {
  string id = 1;
}

message ListProjectAdminsResponse {
  repeated User users = 1;
}

message AddProjectAdminRequestBody {
  repeated string user_ids = 1;
}

message AddProjectAdminRequest {
  string id = 1;
  AddProjectAdminRequestBody body = 2;
}

message AddProjectAdminResponse {
  repeated User users = 1;
}

message RemoveProjectAdminRequest {
  string id = 1;
  string user_id = 2;
}

message RemoveProjectAdminResponse {
  string message = 1;
}

message Action {
  string id = 1;
  string name = 2 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
  Namespace namespace = 3;
  google.protobuf.Timestamp created_at = 4;
  google.protobuf.Timestamp updated_at = 5;
}

message Namespace {
  string id = 1;
  string name = 2 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;
}

message Policy {
  string id = 1;
  Role role = 2;
  Action action = 3;
  Namespace namespace = 4;
  google.protobuf.Timestamp created_at = 5;
  google.protobuf.Timestamp updated_at = 6;
}

message ActionRequestBody {
  string id = 1;
  string name = 2 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
  string namespace_id = 3;
}

message NamespaceRequestBody {
  string id = 1;
  string name = 2 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];
}

message PolicyRequestBody {
  string role_id = 1;
  string action_id = 2;
  string namespace_id = 3;
}

message ListActionsRequest {

}

message ListActionsResponse {
  repeated Action actions = 1;
}

message CreateActionRequest {
  ActionRequestBody body = 1;
}

message CreateActionResponse {
  Action action = 1;
}

message GetActionRequest {
  string id = 1;
}

message GetActionResponse {
  Action action = 1;
}

message UpdateActionRequest {
  string id = 1;
  ActionRequestBody body = 2;
}

message UpdateActionResponse {
  Action action = 1;
}

message ListNamespacesRequest {

}

message ListNamespacesResponse {
  repeated Namespace namespaces = 1;
}

message CreateNamespaceRequest {
  NamespaceRequestBody body = 1;
}

message CreateNamespaceResponse {
  Namespace namespace = 1;
}

message GetNamespaceRequest {
  string id = 1;
}

message GetNamespaceResponse {
  Namespace namespace = 1;
}

message UpdateNamespaceRequest {
  string id = 1;
  NamespaceRequestBody body = 2;
}

message UpdateNamespaceResponse {
  Namespace namespace = 1;
}

message ListPoliciesRequest {

}

message ListPoliciesResponse {
  repeated Policy policies = 1;
}

message CreatePolicyRequest {
  PolicyRequestBody body = 1;
}

message CreatePolicyResponse {
  repeated Policy policies = 1;
}

message GetPolicyRequest {
  string id = 1;
}

message GetPolicyResponse {
  Policy policy = 1;
}

message UpdatePolicyRequest {
  string id = 1;
  PolicyRequestBody body = 2;
}

message UpdatePolicyResponse {
  repeated Policy policies = 1;
}

message Relation {
  string id = 1;
  Namespace subject_type = 2;
  string subject_id = 3;
  Namespace object_type = 4;
  string object_id = 5;
  Role role = 6;
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp updated_at = 8;
}

message Resource {
  string id = 1;
  string name = 2;
  Group group = 3;
  Project project = 4;
  Organization organization = 5;
  Namespace namespace = 6;
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp updated_at = 8;
  User user = 9;
  string urn = 10;
}

message ListRelationsRequest {

}

message ListRelationsResponse {
  repeated Relation relations = 1;
}

message RelationRequestBody {
  string subject_type = 1;
  string subject_id = 2;
  string object_type = 3;
  string object_id = 4;
  string role_id = 5;
}

message CreateRelationRequest {
  RelationRequestBody body = 1;
}

message CreateRelationResponse {
  Relation relation = 1;
}

message GetRelationRequest {
  string id = 1;
}

message GetRelationResponse {
  Relation relation = 1;
}

message UpdateRelationRequest {
  string id = 1;
  RelationRequestBody body = 2;
}

 message UpdateRelationResponse {
  Relation relation = 1;
 }

 message ListResourcesRequest {
  string group_id = 1;
  string project_id = 2;
  string organization_id = 3;
  string namespace_id = 4;
 }

 message ListResourcesResponse {
  repeated Resource resources = 1;
 }

 message ResourceRequestBody {
  string name = 1;
  string group_id = 2;
  string project_id = 3;
  string organization_id = 4;
  string namespace_id = 5;
  string user_id = 6;
 }

 message CreateResourceRequest {
  ResourceRequestBody body = 1;
 }

 message CreateResourceResponse {
  Resource resource = 1;
 }

 message GetResourceRequest {
  string id = 1;
 }

 message  GetResourceResponse {
  Resource resource = 1;
 }

 message UpdateResourceRequest {
  string id = 1;
  ResourceRequestBody body = 2;
 }

 message UpdateResourceResponse {
  Resource resource = 1;
 }

 message ResourceActionAuthzRequest {
  string resource_id = 1 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];;
  string action_id   = 2 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];;
  string namespace_id  = 3 [(validate.rules).string.pattern = "^[A-Za-z0-9_-]+$"];;
 }

 message ResourceActionAuthzResponse {
  string status = 1;
 }